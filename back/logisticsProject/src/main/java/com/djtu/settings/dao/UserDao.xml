<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.djtu.settings.dao.UserDao">

    <select id="getUserIdByStudentId" resultType="java.lang.String">
        select id from tbl_user where student_id = #{id};
    </select>
    <select id="getUserIdByTutorId" resultType="java.lang.String">
        select id from tbl_user where tutor_id = #{id};
    </select>
    <select id="getUserIdByAdminId" resultType="java.lang.String">
        select id from tbl_user where admin_id = #{id};
    </select>
    <resultMap id="userRoleVo" type="UserRoleVo">
        <result column="username" property="username"/>
        <result column="sname" property="name"/>
        <result column="id" property="id"/>
        <result column="sex" property="sex"/>
        <result column="remark" property="remark"/>
        <collection ofType="String" property="perms">
            <result column="rname" />
        </collection>
    </resultMap>
    <select id="getStudentUserRoleVoList" resultType="com.djtu.settings.pojo.vo.UserRoleVo" resultMap="userRoleVo">
        select u.id, s.name sname, r.name rname, username, sex, remark
        from tbl_user u
                 left join tbl_user_role ur
                           on ur.user_id = u.id
                 left join tbl_role r
                           on ur.role_id = r.id
                 left join tbl_student s
                           on s.id = u.student_id
        where u.student_id in (
            select id from tbl_student
        )
    </select>
    <insert id="setStudentUser">
        insert into tbl_user (
                              id,
                              student_id)
        values(
                #{id},
                #{studentId}
              )
    </insert>

    <insert id="setTutorUser">
        insert into tbl_user (
            id,
            tutor_id)
        values(
                  #{id},
                  #{tutorId}
              )
    </insert>
</mapper>
